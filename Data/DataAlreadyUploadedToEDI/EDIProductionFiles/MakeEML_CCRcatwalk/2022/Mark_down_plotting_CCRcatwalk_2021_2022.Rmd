---
title: "CCR Catwalk Plots for EDI"
output: html_document
date: "2023-01-04"
---
 Master QAQC script in prep for publishing catwalk sensor string data to EDI
 this script usings the qaqc_ccr which automatically QAQCs the data. 
 This script prodcues figures to look over the data to visually 
 inspect it and make sure there are no outliers. 
 The final step is to write the final csv 

This step gets the right packages, sets the correct folder and then 
sources the QAQC script. Make sure you have the correct year
## Set Up
```{r Set Up}
pacman::p_load("RCurl","tidyverse","lubridate", "plotly", "magrittr")
source("CCR_catwalk_QAQC_function_2021_2022.R")


# Set up the current time end time of the file and the current year for QAQC plots

#current time of QAQC for graphing
current_time_start="2022-01-01 00:00:00"
current_time_end="2022-12-31 23:59:00"
```

##Create misc_data_files folder 
This chunk makes the folder where the raw data will be stored
```{r Create Data folder}
### Create a misc_data_files folder if one doesn't already exist
misc_folder <- "misc_data_files"
if (file.exists(misc_folder)) {
  cat("The folder already exists")
} else {
  dir.create(misc_folder)
}

```

## Download the Raw Data
This section downloads the data from Github and the maintenance file. 
If there are changes to the data on Github then you have to redownload the files
```{r Download data} 
# Set the timeout option to 100 seconds instead of 60
options(timeout=200)

# download most up to date catwalk data and maintenance log for input into the function
download.file("https://raw.githubusercontent.com/FLARE-forecast/CCRE-data/ccre-dam-data/CCRW_maintenance_log.txt", "CCRW_maintenance_log_2021_2022.txt")
download.file("https://raw.githubusercontent.com/FLARE-forecast/CCRE-data/ccre-dam-data/ccre-waterquality.csv", "./misc_data_files/ccre-waterquality.csv")

```

## QAQC Function
This section sets up and runs the QAQC function. The out put tells you the missing observations.
If you can't find them in the manual downloads then make sure to put these times in the methods
section under missing.
```{r Run the QAQC function}
# run standard qaqc function from FCR_catwalk_QAQC_function_2021.R
data_file <-  "./misc_data_files/ccre-waterquality.csv"#current file from the data logger
maintenance_file <-  "./CCRW_maintenance_log_2021_2022.txt"#maintenance file
output_file <-  "./misc_data_files/CCRwaterquality_first_QAQC_2021_2022.csv"#name of the output file

# Run the QAQC function
qaqc_ccr(data_file, maintenance_file, output_file)#function to do the main qaqc

```

## Read in the QAQC File and Check it out
This section reads in the QAQC file and then you can look at the head, tail and structure. 
Make sure the last row is Dec. 31 23:50 of the publishing year. There should be 97 columns unless a new 
one is added. 
```{r Read in QAQC file and look at it}
# read in qaqc function output

ccrwater <- read.csv("./misc_data_files/CCRwaterquality_first_QAQC_2021_2022.csv")

# subset file to only unpublished data
ccrwater <- ccrwater[ccrwater$DateTime<current_time_end,]

head(ccrwater)
tail(ccrwater)
str(ccrwater)
```


Let's look at the flag Frequency for each variable. As a reminder here are the flag codes
 Flag values
  0: no flag
  1: value removed due to maintenance and set to NA
  2: negative or outlier value removed and set to NA, see Methods section for more detail on QAQC process
  3: negative values set to 0
  4: value removed due to fouling and set to NA
  5: questionable value due to potential fouling
  6: very questionable value due to potential fouling. Values adjusted using a linear or square root function     to match high-resolution CTD profiles are given in RDO_mgL_5 and RDO_sat_percent_5
  7: missing data
  8: Value corrected using a constant offset due to two thermistor malfunctions in Fall 2020

It looks like it gives an error but all the columns are there. 
```{r Check out the flags}

#make sure no NAS in the Flag columns
Flags=ccrwater%>%
  select(DateTime, starts_with("Flag"))

RowsNA=Flags[!complete.cases(Flags), ] # Keep only the complete rows

#check the flag column
Flags=ccrwater%>%
  select(starts_with("Flag"))

# for loop that counts number of NAs in each column, should be zero since everything should have a flag number or 0
 for (i in colnames(Flags)){
   print(sum(is.na(Flags[i])))
   }

# Make a table with the number of times a flag was used
for(f in 1:nrow(Flags)){
  print(colnames(Flags[f]))
  print(table(Flags[,f], useNA = "always"))
}
```

```{r Let's get our graphing data frame}

ccrwater2 <-ccrwater

ccrwater2$DateTime<-ymd_hms(ccrwater2$DateTime)

```
##Lets graph all the Data

There is a lot data and lots of plots. It will most likely crash if you try to run it all so just run a 
chunk at a time. 

## Temperature 
Thermistor 1
```{r Thermistor 1}
 m_1 <- ggplot(data = ccrwater2, aes(x = DateTime, y = ThermistorTemp_C_1)) +
  geom_point()
 m_1
#Only use plotly to find DateTime of questionable values
# ggplotly(m_1)

# #Just the current year
 m_1_21=ccrwater2%>%
  filter(DateTime>ymd_hms(current_time_start) & DateTime<ymd_hms(current_time_end))%>%
   ggplot(.,aes(x = DateTime, y = ThermistorTemp_C_1)) +
   geom_point()
 m_1_21
#Only use plotly to find DateTime of questionable values
 #ggplotly(m_1_21)
```

```{r Thermistor 2}
# check 2 temp data
#Plot 2021-current
 m_2 <- ggplot(data = ccrwater2, aes(x = DateTime, y = ThermistorTemp_C_2)) +
  geom_point()
 m_2
#Only use plotly to find DateTime of questionable values
# ggplotly(m_2)

 #Just the current year
 m_2_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = ThermistorTemp_C_2)) +
   geom_point()
 m_2_21
#Only use plotly to find DateTime of questionable values
 #ggplotly(m_2_21)
```

```{r EXO at 1.5m }
# check EXO 1.5m temp data
 # Plot 2021-current
 EXOtemp_1 <- ggplot(data = ccrwater2, aes(x = DateTime, y = EXOTemp_C_1)) +
    geom_point()
 EXOtemp_1
 #Only use plotly to find DateTime of questionable values
 # ggplotly(EXOtemp_1)
 
 # Just the current year
 EXOtemp_1_21=ccrwater2%>%
    filter(DateTime>current_time_start & DateTime<current_time_end)%>%
    ggplot(.,aes(x = DateTime, y = EXOTemp_C_1)) +
    geom_point()
 EXOtemp_1_21
 #Only use plotly to find DateTime of questionable values
 # ggplotly(EXOtemp_1)
```

```{r Thermistor 3}
# check 3 temp data
#Plot From 2021-current
 m_3 <- ggplot(data = ccrwater2, aes(x = DateTime, y = ThermistorTemp_C_3)) +
  geom_point()
 m_3
#Only use plotly to find DateTime of questionable values
# ggplotly(m_3)

#Just the current year
 m_3_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = ThermistorTemp_C_3)) +
   geom_point()
 m_3_21
#Only use plotly to find DateTime of questionable values
# ggplotly(m_3_21)
```

```{r Thermistor 4}
# check 4 temp data
#Plot from 2021-current
 m_4 <- ggplot(data = ccrwater2, aes(x = DateTime, y = ThermistorTemp_C_4)) +
  geom_point()
 m_4
#Only use plotly to find DateTime of questionable values
# ggplotly(m_4)

# Just from current year
 m_4_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = ThermistorTemp_C_4)) +
   geom_point()
 m_4_21
#Only use plotly to find DateTime of questionable values
# ggplotly(m_4_21)
```

```{r Thermistor 5}
# check 5 temp data
# Plot from 2021-current
 m_5 <- ggplot(data = ccrwater2, aes(x = DateTime, y = ThermistorTemp_C_5)) +
   geom_point()
 m_5
#Only use plotly to find DateTime of questionable values
# ggplotly(m_5)

# Just current year
 m_5_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = ThermistorTemp_C_5)) +
   geom_point()
 m_5_21
#Only use plotly to find DateTime of questionable values
 #ggplotly(m_5_21)
```

```{r Thermistor 6}
# check 6 temp data
# Plot from 2021-current
   m_6 <- ggplot(data = ccrwater2, aes(x = DateTime, y = ThermistorTemp_C_6)) +
  geom_point()
 m_6
#Only use plotly to find DateTime of questionable values
# ggplotly(m_6)

# Just the current year
 m_6_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = ThermistorTemp_C_6)) +
   geom_point()
m_6_21
#Only use plotly to find DateTime of questionable values
 #ggplotly(m_6_21)
```

```{r Thermistor 7}
# check 7 temp data
# all the temp 2021-current
 m_7 <- ggplot(data = ccrwater2, aes(x = DateTime, y = ThermistorTemp_C_7)) +
  geom_point()
 m_7
#Only use plotly to find DateTime of questionable values
# ggplotly(m_7)

#filter for the current year
 m_7_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = ThermistorTemp_C_7)) +
   geom_point()
m_7_21
# plotly so you can pick out the questionable values
 #ggplotly(m_7_21)
```

```{r Thermistor 8}
# check 8 temp data
# Plot 2021-current
 m_8 <- ggplot(data = ccrwater2, aes(x = DateTime, y = ThermistorTemp_C_8)) +
  geom_point()
 m_8
#Only use plotly to find DateTime of questionable values
# ggplotly(m_8)

# # Plot just the current year
 m_8_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = ThermistorTemp_C_8)) +
   geom_point()
 m_8_21
#Only use plotly to find DateTime of questionable values
# ggplotly(m_8_21)
```

```{r Thermistor 9}
# check 9 temp data
  # Plot 2021-current
 m_9 <- ggplot(data = ccrwater2, aes(x = DateTime, y = ThermistorTemp_C_9)) +
  geom_point()
 m_9
#Only use plotly to find DateTime of questionable values
# ggplotly(m_9)

# Just the current year
 m_9_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = ThermistorTemp_C_9)) +
   geom_point()
 m_9_21
#Only use plotly to find DateTime of questionable values
# ggplotly(m_9_21)
```

```{r EXO at 9m}
# check EXO 9m temp data
 # Plot 2021-current
 EXOtemp_9 <- ggplot(data = ccrwater2, aes(x = DateTime, y = EXOTemp_C_9)) +
    geom_point()
 EXOtemp_9
 #Only use plotly to find DateTime of questionable values
 # ggplotly(EXOtemp_9)
 
 # Just the current year
 EXOtemp_9_21=ccrwater2%>%
    filter(DateTime>current_time_start & DateTime<current_time_end)%>%
    ggplot(.,aes(x = DateTime, y = EXOTemp_C_9)) +
    geom_point()
 EXOtemp_9_21
 #Only use plotly to find DateTime of questionable values
 # ggplotly(EXOtemp_9)
``` 
 
 
```{r Thermistor 10}
  # check 10 temp data
   #From 2021-current
   m_10 <- ggplot(data = ccrwater2, aes(x = DateTime, y = ThermistorTemp_C_10)) +
    geom_point()
   m_10
  #Only use plotly to find DateTime of questionable values
   ggplotly(m_10)
  
   #Just the current year
   m_10_21=ccrwater2%>%
    filter(DateTime>current_time_start & DateTime<current_time_end)%>%
     ggplot(.,aes(x = DateTime, y = ThermistorTemp_C_10)) +
     geom_point()
   m_10_21
  #Only use plotly to find DateTime of questionable values
  # ggplotly(m_10_21)
```

```{r Thermistor 11}
  # check 11 temp data
  #From 2021-current
   m_11 <- ggplot(data = ccrwater2, aes(x = DateTime, y = ThermistorTemp_C_11)) +
    geom_point()
   m_11
  #Only use plotly to find DateTime of questionable values
   #ggplotly(m_11)
  
  #Just the current year
   m_11_21=ccrwater2%>%
    filter(DateTime>current_time_start & DateTime<current_time_end)%>%
     ggplot(.,aes(x = DateTime, y = ThermistorTemp_C_11)) +
     geom_point()
   m_11_21
  #Only use plotly to find DateTime of questionable values
  # ggplotly(m_11_21)
```

```{r Thermistor 12}
  # check 12 temp data
  #From 2021-current
   m_12 <- ggplot(data = ccrwater2, aes(x = DateTime, y = ThermistorTemp_C_12)) +
    geom_point()
   m_12
  #Only use plotly to find DateTime of questionable values
  # ggplotly(m_12)
  
  # #Just the current year
   m_12_21=ccrwater2%>%
    filter(DateTime>current_time_start & DateTime<current_time_end)%>%
     ggplot(.,aes(x = DateTime, y = ThermistorTemp_C_12)) +
     geom_point()
   m_12_21
 #Only use plotly to find DateTime of questionable values
  # ggplotly(m_12_21)
```

```{r Thermistor 13}
  # check 13 temp data
  #From 2021-current
   m_13 <- ggplot(data = ccrwater2, aes(x = DateTime, y = ThermistorTemp_C_13)) +
    geom_point()
   m_13
  #Only use plotly to find DateTime of questionable values
   #ggplotly(m_13)
  
  #Just the current year
   m_13_21=ccrwater2%>%
    filter(DateTime>current_time_start & DateTime<current_time_end)%>%
     ggplot(.,aes(x = DateTime, y = ThermistorTemp_C_13)) +
     geom_point()
   m_13_21
   #Only use plotly to find DateTime of questionable values
   #ggplotly(m_13_21)
   
   # Compare the bottom Thermistor with the temperature on the Pressure sensor
   
   # All the years
   
    comp_m_13 <- ggplot(data = ccrwater2, aes(x = DateTime, y = ThermistorTemp_C_13)) +
    geom_point(aes(y=ThermistorTemp_C_13, color="Therm"))+ 
      geom_point(aes(y=LvlTemp_C_13, color="Pressure"))+
      labs(y=expression(''*~degree*C*'')) +
    scale_color_manual(name = "Sensor",
                       breaks = c("Therm", "Pressure"),
                       values = c("Therm"="firebrick1", "Pressure"="black"))
   comp_m_13
   
   
   
    #Just the current year
   comp_13_21=ccrwater2%>%
    filter(DateTime>current_time_start & DateTime<current_time_end)%>%
     ggplot(aes(x = DateTime, y = ThermistorTemp_C_13))+
     geom_point(aes(y=ThermistorTemp_C_13, color="Therm"))+ 
      geom_point(aes(y=LvlTemp_C_13, color="Pressure"))+
      labs(y=expression(''*~degree*C*'')) +
    scale_color_manual(name = "Sensor",
                       breaks = c("Therm", "Pressure"),
                       values = c("Therm"="firebrick1", "Pressure"="black"))
   comp_13_21
```
  
```{r All Temperature}

 All_temp_ccr=ccrwater2%>%
    ggplot(.,aes(x = DateTime))+
    geom_line(aes(y=ThermistorTemp_C_1, color="0.1m"))+
    geom_line(aes(y=ThermistorTemp_C_2, color="1m"))+
    geom_line(aes(y=EXOTemp_C_1, color="EXO_1m")) +
    geom_line(aes(y=ThermistorTemp_C_3, color="2m"))+
    geom_line(aes(y=ThermistorTemp_C_4, color="3m"))+
    geom_line(aes(y=ThermistorTemp_C_5, color="4m"))+
    geom_line(aes(y=ThermistorTemp_C_6, color="5m"))+
    geom_line(aes(y=ThermistorTemp_C_7, color="6m"))+
    geom_line(aes(y=ThermistorTemp_C_8, color="7m"))+
    geom_line(aes(y=ThermistorTemp_C_9, color="8m"))+
    geom_line(aes(y=EXOTemp_C_9, color="EXO_9m")) +
    geom_line(aes(y=ThermistorTemp_C_10, color="10m"))+
    geom_line(aes(y=ThermistorTemp_C_11, color="11m"))+
    geom_line(aes(y=ThermistorTemp_C_12, color="15m"))+
    geom_line(aes(y=ThermistorTemp_C_13, color="19m"))+
    labs(y=expression(''*~degree*C*'')) +
    scale_color_manual(name = "Depth",
                       breaks = c("0.1m", "1m","EXO_1m", "2m", "3m", "4m", "5m", "6m", "7m", "8m",
                                  "EXO_9m","10m","11m","15m","19m"),
                       values = c("0.1m"="firebrick1", "1m"="DarkOrange1", "EXO_1m"="yellow","2m"="gold", 
                                  "3m"="greenyellow", "4m"="medium sea green", "5m"="sea green",
                                  "6m"="DeepSkyBlue4", "7m"="blue2", "8m"="cornsilk", "EXO_9m"="blue4",    "10m"="darkslateblue","11m"="magenta2", "15m"="darkmagenta", "19m"="black"))

All_temp_ccr
  
# This is all the temps and just the current year

Cur_temp_ccr=ccrwater2%>%
   filter(DateTime>current_time_start & DateTime<current_time_end)%>%
    ggplot(.,aes(x = DateTime))+
    geom_line(aes(y=ThermistorTemp_C_1, color="0.1m"))+
    geom_line(aes(y=ThermistorTemp_C_2, color="1m"))+
    geom_line(aes(y=EXOTemp_C_1, color="EXO_1m")) +
    geom_line(aes(y=ThermistorTemp_C_3, color="2m"))+
    geom_line(aes(y=ThermistorTemp_C_4, color="3m"))+
    geom_line(aes(y=ThermistorTemp_C_5, color="4m"))+
    geom_line(aes(y=ThermistorTemp_C_6, color="5m"))+
    geom_line(aes(y=ThermistorTemp_C_7, color="6m"))+
    geom_line(aes(y=ThermistorTemp_C_8, color="7m"))+
    geom_line(aes(y=ThermistorTemp_C_9, color="8m"))+
    geom_line(aes(y=EXOTemp_C_9, color="EXO_9m")) +
    geom_line(aes(y=ThermistorTemp_C_10, color="10m"))+
    geom_line(aes(y=ThermistorTemp_C_11, color="11m"))+
    geom_line(aes(y=ThermistorTemp_C_12, color="15m"))+
    geom_line(aes(y=ThermistorTemp_C_13, color="19m"))+
    labs(y=expression(''*~degree*C*'')) +
    scale_color_manual(name = "Depth",
                       breaks = c("0.1m", "1m","EXO_1m", "2m", "3m", "4m", "5m", "6m", "7m", "8m",
                                  "EXO_9m","10m","11m","15m","19m"),
                       values = c("0.1m"="firebrick1", "1m"="DarkOrange1", "EXO_1m"="yellow","2m"="gold", 
                                  "3m"="greenyellow", "4m"="medium sea green", "5m"="sea green",
                                  "6m"="DeepSkyBlue4", "7m"="blue2", "8m"="cornsilk", "EXO_9m"="blue4",    "10m"="darkslateblue","11m"="magenta2", "15m"="darkmagenta", "19m"="black"))

Cur_temp_ccr
  
```

## Check out the Depth sensor and EXO

```{r Pressure Sensor}  
### Plotting depth from pressure sensor 
   
   Depth_press_sensor <- ggplot(data = ccrwater2, aes(x = DateTime, y = LvlDepth_m_13)) +
      geom_point()
   Depth_press_sensor
   #Only use plotly to find DateTime of questionable values
      #ggplotly(Depth_press_sensor)

# Check that the top three depths look good and all temps that should be removed are.
# This looks at the air temp, thermistors 1 through 3 and the depth of the reservoir. 
# Right now the depth of the reservoir is commented out. 
   a=ccrwater2%>%
    #filter(DateTime>"2021-05-17 00:00" & DateTime<"2021-05-20 00:00")%>%
    ggplot(aes(x=DateTime))+
    geom_line(aes(y=CR3000Panel_Temp_C, color="black"))+
    geom_line(aes(y=ThermistorTemp_C_1, color="red"))+
    geom_line(aes(y=ThermistorTemp_C_2, color="blue"))+
    geom_line(aes(y=ThermistorTemp_C_3, color="green"))+
    geom_line(aes(y=LvlDepth_m_13, color="purple"))
   
   a
```

```{r EXO 1.5m depth}
#Depth
#Making sure I didn't miss any times when the EXO was out of place according to the depth sensor

#Depth from the 1m EXO
 Depth_1 <- ggplot(data = ccrwater2, aes(x = DateTime, y = EXO_depth_m_1)) +
   geom_point()
 Depth_1
#Only use plotly to find DateTime of questionable values
# ggplotly(Depth_1)
 
#Just the current year
 Depth_1_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
  ggplot(.,aes(x = DateTime, y = EXO_depth_m_1)) +
   geom_point()
 Depth_1_21
#Only use plotly to find DateTime of questionable values
# ggplotly(Depth_1_21)
``` 
 
```{r EXO depth 9m}
 #Depth from the 9m EXO
 Depth_9 <- ggplot(data = ccrwater2, aes(x = DateTime, y = EXO_depth_m_9)) +
   geom_point()
 Depth_9
 #Only use plotly to find DateTime of questionable values
 # ggplotly(Depth_9)
 
 #Just the current year
 Depth_9_21=ccrwater2%>%
   filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = EXO_depth_m_9)) +
   geom_point()
 Depth_9_21
 #Only use plotly to find DateTime of questionable values
 # ggplotly(Depth_9_21)

```

## Let's look at the DO sensors on the EXO
```{r DO from the EXO at 1.5m }
#Check 1.5m EXO DO data
#Plot 2021-current DO obs
 EXODO_1 <- ggplot(data = ccrwater2, aes(x = DateTime, y = EXODO_mgL_1)) +
   geom_point()
 EXODO_1
 #Only use plotly to find DateTime of questionable values
 #ggplotly(EXODO_1)
 
 EXODOsat_1 <- ggplot(data = ccrwater2, aes(x = DateTime, y = EXODOsat_percent_1)) +
   geom_point()
 EXODOsat_1
 #Only use plotly to find DateTime of questionable values
 #ggplotly(EXODOsat_1)
 
#Plot Just the current year
 EXODO_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = EXODO_mgL_1)) +
   geom_point()
 EXODO_21
#Only use plotly to find DateTime of questionable values
 #ggplotly(EXODO_21)
 
 EXODOsat_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = EXODOsat_percent_1)) +
   geom_point()
 EXODOsat_21
#Only use plotly to find DateTime of questionable values
 #ggplotly(EXODOsat_21)
``` 

```{r DO from the 9m EXO} 
# Plot the 9m Do from EXO
# From 2021-current 
 EXO9=ggplot(ccrwater2, aes(x = DateTime, y = EXODO_mgL_9)) +
   geom_point()
 EXO9
#Only use plotly to find DateTime of questionable values
 #ggplotly(EXO9)
 
 # From 2021-current 
 EXO9_sat=ggplot(ccrwater2, aes(x = DateTime, y = EXODOsat_percent_9)) +
   geom_point()
 EXO9_sat
#Only use plotly to find DateTime of questionable values
 #ggplotly(EXO9_sat)
 
 #Just the current year
 EXO9_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = EXODO_mgL_9)) +
   geom_point()
 EXO9_21
#Only use plotly to find DateTime of questionable values
 #ggplotly(EXO9_21)
 
 EXO9sat_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = EXODOsat_percent_9)) +
   geom_point()
 EXO9sat_21
#Only use plotly to find DateTime of questionable values
 #ggplotly(EXO9sat_21)
```

##Check out the Algae Senor on the EXO
```{r Check the EXO Chla}

# chl and phyco visual qaqc-plot to see if everything looks right

# Chla 1m EXO
# Plot for 2021-current
 chl_ugl_1 <- ggplot(data = ccrwater2, aes(x = DateTime, y = EXOChla_ugL_1)) +
   geom_point() 
 chl_ugl_1
#Only use plotly to find DateTime of questionable values
 #ggplotly(chl_ugl_1)
 
# Plot just the current year
 chl_ugl_1_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = EXOChla_ugL_1)) +
   geom_point()
 chl_ugl_1_21
 #Only use plotly to find DateTime of questionable values
 #ggplotly(chl_ugl_1_21)
 
# plot the daily mean
# calculate the daily mean
 chl_mean_1 <- ccrwater2 %>%
  select(DateTime, EXOChla_ugL_1) %>%
  mutate(day = date(DateTime)) %>%
  group_by(day) %>%
  mutate(daily_mean = mean(EXOChla_ugL_1, na.rm = TRUE)) %>%
  distinct(day, .keep_all = TRUE)
# 
# plot the daily mean
 chl_mean_plot <- ggplot(data = chl_mean_1, aes(x = day, y = daily_mean)) +
  geom_point()
 chl_mean_plot
#Only use plotly to find DateTime of questionable values
 #ggplotly(chl_mean)

# Plot the chla and the daily mean on the same graph
 plot(ccrwater2$DateTime, ccrwater2$EXOChla_ugL_1)
 points(chl_mean_1$DateTime, chl_mean_1$daily_mean, type="l", col="green")

 
# Chla-RFU
# Plot 2021-current
 chl_rfu <- ggplot(data = ccrwater2, aes(x = DateTime, y = EXOChla_RFU_1)) +
   geom_point()
 chl_rfu
#Only use plotly to find DateTime of questionable values
 #ggplotly(chl_rfu)

# Just the current year
 chl_rfu_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = EXOChla_RFU_1)) +
   geom_point()
 chl_rfu_21
```


```{r Check out the Phyco in EXO}
# Phyco-RFU
# Plot 2021-current
 phyco_rfu <- ggplot(data = ccrwater2, aes(x = DateTime, y = EXOBGAPC_RFU_1)) +
   geom_point() 
 phyco_rfu
#Only use plotly to find DateTime of questionable values
 #ggplotly(phyco_rfu)
 
# Just the current year
 phyco_rfu_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = EXOBGAPC_RFU_1)) +
   geom_point()
#Only use plotly to find DateTime of questionable values
 #ggplotly(phyco_rfu_21)

 # Phyco-ugL
# Plot 2021-current
 phyco_ugl <- ggplot(data = ccrwater2, aes(x = DateTime, y = EXOBGAPC_ugL_1)) +
   geom_point() 
 phyco_ugl
#Only use plotly to find DateTime of questionable values
 #ggplotly(phyco_ugl)
 
# Just the current year
 phyco_ugl_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = EXOBGAPC_ugL_1)) +
   geom_point()
#Only use plotly to find DateTime of questionable values
 #ggplotly(phyco_ugl_21)
```

```{r fdom EXO sensor}
#fDOM-RFU 1m EXO
# Plot 2021-current
 fDOM_rfu_1 <- ggplot(data = ccrwater2, aes(x = DateTime, y = EXOfDOM_RFU_1)) +
   geom_point() 
 fDOM_rfu_1
#Only use plotly to find DateTime of questionable values
 #ggplotly(fDOM_rfu_1)
 
# Just the current year
 fDOM_rfu_1_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = EXOfDOM_RFU_1)) +
   geom_point()
 fDOM_rfu_1_21
#Only use plotly to find DateTime of questionable values
 #ggplotly(fDOM_rfu_1_21)
 
  # fDOM-QSU 1m EXO
# Plot 2021-current
 fDOM_qsu_1 <- ggplot(data = ccrwater2, aes(x = DateTime, y = EXOfDOM_QSU_1)) +
   geom_point() 
 fDOM_qsu_1
 #Only use plotly to find DateTime of questionable values
 #ggplotly(fDOM_qsu_1)
 
# Just the current year
 fDOM_qsu_1_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = EXOfDOM_QSU_1)) +
   geom_point()
 fDOM_qsu_1_21
#Only use plotly to find DateTime of questionable values
 #ggplotly(fDOM_qsu_1_21)
```

```{r fDOM at 9m }
# fDOM-RFU 9m EXO
# Plot 2021-current
   fDOM_rfu_9 <- ggplot(data = ccrwater2, aes(x = DateTime, y = EXOfDOM_RFU_9)) +
     geom_point() 
   fDOM_rfu_9
#Only use plotly to find DateTime of questionable values
   #ggplotly(fDOM_rfu_9)
   
# Just the current year
   fDOM_rfu_9_21=ccrwater2%>%
    filter(DateTime>current_time_start & DateTime<current_time_end)%>%
     ggplot(.,aes(x = DateTime, y = EXOfDOM_RFU_9)) +
     geom_point()
   fDOM_rfu_9_21
#Only use plotly to find DateTime of questionable values
   #ggplotly(fDOM_rfu_9_21)
 
# fDOM-QSU 9m EXO
# Plot 2021-current
   fDOM_qsu_9 <- ggplot(data = ccrwater2, aes(x = DateTime, y = EXOfDOM_QSU_9)) +
     geom_point() 
   fDOM_qsu_9
#Only use plotly to find DateTime of questionable values
   #ggplotly(fDOM_qsu_9)
   
# Just the current year
   fDOM_qsu_9_21=ccrwater2%>%
    filter(DateTime>current_time_start & DateTime<current_time_end)%>%
     ggplot(.,aes(x = DateTime, y = EXOfDOM_QSU_9)) +
     geom_point()
   fDOM_qsu_9_21
#Only use plotly to find DateTime of questionable values
 #ggplotly(fDOM_qsu_9_21)
```

## EXO Conductivity Sensor
```{r EXO Condctivity Sensor at 1.5m }

Cond_1 <- ggplot(data = ccrwater2, aes(x = DateTime, y = EXOCond_uScm_1)) +
   geom_point()
 Cond_1
#Only use plotly to find DateTime of questionable values
 #ggplotly(Cond_1)

#Just the current year
 
 Cond_1_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = EXOCond_uScm_1)) +
   geom_point()
 Cond_1_21
#Only use plotly to find DateTime of questionable values
 #ggplotly(Cond_1_21)
 
 
 #Plot from 2021-current
 SpCond_1 <- ggplot(data = ccrwater2, aes(x = DateTime, y = EXOSpCond_uScm_1)) +
   geom_point()
 SpCond_1
#Only use plotly to find DateTime of questionable values
 #ggplotly(SpCond_1)
 
#Just the current year
 SpCond_1_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = EXOSpCond_uScm_1)) +
   geom_point()
 SpCond_1_21
#Only use plotly to find DateTime of questionable values
# ggplotly(SpCond_1_21)
```

```{r EXO Cond 9m}

 #Cond from 9m EXO 
 #Plot from 2021-current
 Cond_9 <- ggplot(data = ccrwater2, aes(x = DateTime, y = EXOCond_uScm_9)) +
   geom_point()
 Cond_9
 #Only use plotly to find DateTime of questionable values
 #ggplotly(Cond_9)
 
 
 #Just the current year
 Cond_9_21=ccrwater2%>%
   filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = EXOCond_uScm_9)) +
   geom_point()
 Cond_9_21
 #Only use plotly to find DateTime of questionable values
 #ggplotly(Cond_9_21)

#Specific Conductivity from 9m EXO
 
 #Plot from 2021-current
 SpCond_9 <- ggplot(data = ccrwater2, aes(x = DateTime, y = EXOSpCond_uScm_9)) +
   geom_point()
 SpCond_9
 #Only use plotly to find DateTime of questionable values
 #ggplotly(SpCond_9)
 
 #Just the current year
 SpCond_9_21=ccrwater2%>%
   filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = EXOSpCond_uScm_9)) +
   geom_point()
 SpCond_9_21
 #Only use plotly to find DateTime of questionable values
 # ggplotly(SpCond_9_21)
```

```{r TDS at 1.5m and 9m}
# #Total Dissolved Solids
#TDS for 1m EXO
 TDS_1 <- ggplot(data = ccrwater2, aes(x = DateTime, y = EXOTDS_mgL_1)) +
   geom_point()
 TDS_1
#Only use plotly to find DateTime of questionable values
# ggplotly(TDS_1)
 
#Just the current year
 TDS_1_21=ccrwater2%>%
  filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = EXOTDS_mgL_1)) +
   geom_point()
 TDS_1_21
 #Only use plotly to find DateTime of questionable values
# ggplotly(TDS_1_21)
 
 #TDS for 9m EXO
 TDS_9 <- ggplot(data = ccrwater2, aes(x = DateTime, y = EXOTDS_mgL_9)) +
   geom_point()
 TDS_9
 #Only use plotly to find DateTime of questionable values
 # ggplotly(TDS_9)
 
 #Just the current year
 TDS_9_21=ccrwater2%>%
   filter(DateTime>current_time_start & DateTime<current_time_end)%>%
   ggplot(.,aes(x = DateTime, y = EXOTDS_mgL_9)) +
   geom_point()
 TDS_9_21
 #Only use plotly to find DateTime of questionable values
 # ggplotly(TDS_9_21)
```

If there were any rouge observations that were missed then add them to the maintenance log where they
can be flagged and removed if necessary. 

## Final steps before final csv

These are the final steps before publishing the final csv. Make sure to go back to ccrwater 

```{r Final Steps}

#Order by date and time

ccrwater <- ccrwater[order(ccrwater$DateTime),]

#rearrange the cols. They should already be in order but just making sure. 
 ccrwater <- ccrwater %>% select(Reservoir, Site, DateTime,  
                        ThermistorTemp_C_1, ThermistorTemp_C_2, ThermistorTemp_C_3, ThermistorTemp_C_4,
                        ThermistorTemp_C_5, ThermistorTemp_C_6, ThermistorTemp_C_7, ThermistorTemp_C_8,
                        ThermistorTemp_C_9,ThermistorTemp_C_10,ThermistorTemp_C_11, ThermistorTemp_C_12,
                        ThermistorTemp_C_13, EXOTemp_C_1, EXOCond_uScm_1,
                        EXOSpCond_uScm_1, EXOTDS_mgL_1, EXODOsat_percent_1, EXODO_mgL_1, EXOChla_RFU_1,
                        EXOChla_ugL_1, EXOBGAPC_RFU_1, EXOBGAPC_ugL_1, EXOfDOM_RFU_1, EXOfDOM_QSU_1,
                        EXO_pressure_psi_1, EXO_depth_m_1, EXO_battery_V_1, EXO_cablepower_V_1,EXO_wiper_V_1,
                        EXOTemp_C_9, EXOCond_uScm_9,
                        EXOSpCond_uScm_9, EXOTDS_mgL_9, EXODOsat_percent_9, EXODO_mgL_9, 
                        EXOfDOM_RFU_9, EXOfDOM_QSU_9,EXO_pressure_psi_9, EXO_depth_m_9,EXO_battery_V_9,
                        EXO_cablepower_V_9, EXO_wiper_V_9,Lvl_psi_13,LvlDepth_m_13, LvlTemp_C_13, 
                        RECORD, CR3000_Batt_V, CR3000Panel_Temp_C,everything())

  
write.csv(ccrwater, 'CCR_Catwalk_EDI_2021_2022.csv', row.names = FALSE)
```