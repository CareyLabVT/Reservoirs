---
title: "CTD Meta Processing"
author: "Abby Lewis"
date: "12/11/2019"
output: html_document
---

Created by ASL in 2019 to retrieve historical EDI publication data and add the current year's data
Substantially edited by ASL 10 Dec 2020, 8 Jan 2021, Jan 2022, Dec 2023

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
```

Data from EDI
```{r}
ctd_edi <- read.csv("https://pasta.lternet.edu/package/data/eml/edi/200/13/27ceda6bc7fdec2e7d79a6e4fe16ffdf")
```

Add new data

NOTE need to add missing CCR casts from 2022
```{r}
#For 2023, add SN to EDI data
ctd_edi <- ctd_edi %>%
  mutate(SN = 7809)
#Combine with historical
ctd_comb <- ctd_edi %>%
  full_join(ctd_l1)
qaqc = ctd_comb %>%
  mutate(Date = as_datetime(DateTime))
```

Flag codes for reference
0=Not suspect, 
1=Sample not taken, 
2=Instrument malfunction, 
3=Sample below detection,
4=Negative value set to 0 or NA
5=No sensor on CTD,
6=Measurement above water (removed for most vars)
7=Datetime missing time (date is meaningful but not time)
8=Measurement outside of expected range but retained in dataset

